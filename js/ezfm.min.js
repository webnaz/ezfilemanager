/* ezFilemanager - file manager platform for TinyMCE or stand-alone
 * Copyright (c) Nazaret Armenagian (Naz)
 * Project home: http://www.webnaz.net
 * Version: 3.0 RC
*/
function CheckifCheckBoxChecked(){var e=false;$("input[type='checkbox']:checked").each(function(){if($(this).is(":checked")){e=true}});if(e==1){return true}else{return false}}$(document).ready(function(){function hideNotifications(){var e=new Array;for(i=0;i<messageholder.length;i++){$("."+messageholder[i]).hide();e[i]=$("."+messageholder[i]).outerHeight();$("."+messageholder[i]).css("top",-e[i])}}function doPaste(){$.ajax({type:"POST",url:indexFile+"?folder="+folder+"&action=paste",data:{file:"paste"},success:function(e){if(e=="error"){hideNotifications();$(".errormsg").html("<h4>"+pasteError+"</h4>");jQuery(".errormsg").show();$(".errormsg").animate({top:"0"},500);setTimeout(function(){hideNotifications()},2e3)}else if(e=="emptyPaste"){hideNotifications();$(".errormsg").html("<h4>"+pasteEmptyError+"</h4>");jQuery(".errormsg").show();$(".errormsg").animate({top:"0"},500);setTimeout(function(){hideNotifications()},3e3)}else{y++;var t=e.split(".");$('<tr class="success" id="tr_c'+y+'"><td style="width:10px"></td><td style="width:10px"><a href="#" id="insert_c'+y+'" alt="'+e+'" class="insert"><span class="glyphicon glyphicon-import"></span></a></td><td style="width:10px"></td><td><span id="edit_c'+y+'" alt="c'+y+'">'+t[0]+'</span><span id="ext_c'+y+'">.'+t[1]+"</span></td><td></td><td></td></tr>").prependTo("table > tbody")}}});return true}function jeditableReset(e,t){$("#href_"+id).unbind("click");$("#filetype-"+id).show()}function progress(e){$("#progress").show();if(UploadStart==0){if(e.lengthComputable){$("progress").attr({value:e.loaded,max:e.total})}}}function doMultiDelete(){$(".del").each(function(){var e=$(this);if(e.is(":checked")){var t=$("#record_"+e.attr("alt")).val();var n=$("#ext_"+e.attr("alt")).text();var r=$("#edit_"+e.attr("alt")).text();$.ajax({type:"POST",url:indexFile+"?folder="+folder+"&action=multidelete",data:{record:t,extension:n,file:r},success:function(n){if(n!=""){$("#response").append("<span class='alert alert-danger response'>"+n+removeError+' "'+t+'"</span>')}else{$("#tr_"+e.attr("alt")).remove()}}})}});setInterval(function(){$("#response").html("")},3e3)}var confirmFile;var fileCopy;var fileDownload;var deleteFiles;var createFolder;var selectedFiles;var maxSize;var removeError;var pasteError;var pasteEmptyError;var createError;var emptycreateError;var nothingError;var toomanyError;var invalidError;var xOffset=5;var yOffset=5;var xPreOffset=5;var yPreOffset=120;var id=0;var y=0;var alt="";var UploadStart="0";var messageholder=["errormsg","successmsg","imagePreview","writable"];var domain=window.location.hostname;var lastChar=domain.substr(-1);if(lastChar!="/"){var domain=window.location.hostname+"/"}$("#progress").hide();$("#upload_files").hide();$("#version-pane").html(version);$(function(){windowHeight=$(window).height();containerHeight=windowHeight-100;console.log(containerHeight);$(".pane-home").slimScroll({height:containerHeight+"px"})});hideNotifications();if(writable!=1){$(".writable").show();$("#ezfm-tab a:gt(0)").hide();$(".glyphicon-cog").hide();$("#deleteFiles").hide();$("#filelist td:first-child").remove();$("#filelist th:first-child").remove()}$(".message").click(function(){$(this).animate({top:-$(this).outerHeight()},500)});i18n.init({lng:lang,debug:true,fallbackLng:"en",load:"unspecific",resGetPath:"lng/__ns__-__lng__.json",ns:{namespaces:["translation"],defaultNs:"translation"}},function(e){$("#all").i18n();confirmFile=e("form.confirmFile");fileCopy=e("form.fileCopy");fileDownload=e("form.fileDownload");deleteFiles=e("form.deleteFiles");createFolder=e("form.createFolder");selectedFiles=e("form.selectedFiles");maxSize=e("form.maxSize");removeError=e("error.removeError");pasteError=e("error.pasteError");pasteEmptyError=e("error.pasteEmptyError");createError=e("error.createError");emptycreateError=e("error.emptycreateError");nothingError=e("error.nothingError");toomanyError=e("error.toomanyError");invalidError=e("error.invalidError");tooLargeError=e("error.tooLargeError")});$(function(){$("#ezfm-tab a:first").tab("show")});$(document).on("click",".preview",function(e){var t="";var n=$(this).attr("id").split("-");id=n[1];var r=$(this).attr("alt");var i=$("#width"+id).attr("alt");var s=$("#height"+id).attr("alt");t+="<div  class='thumbnail'>";t+="<img src='/"+folder+r+"' id='previewid' style='width:"+i+"px;height:"+s+"px' class='img-responsive'>";t+="</div>";$("#preview").html(t);$("#preview").css("top",e.pageY-s+"px").css("left",e.pageX+xPreOffset+"px");$("#preview").fadeIn("fast")});$(".preview").bind("mouseleave",function(){$("#preview").hide();$("#preview").html("")});$(document).on("click","a.dropdown-actions",function(e){if(!$(".dropdown-menu").is(":visible")){var t="";var n=$(this).attr("id");var r=$(this).attr("alt");$("ul.dropdown-menu li:lt(2)").show();if(r=="folder"){$("ul.dropdown-menu li:lt(2)").hide()}$(".download").attr("id",n);$(".download").attr("alt",r);$(".filedelete").attr("id",n);$(".copy").attr("id",n);$(".rename").attr("id",n);$(".dropdown-menu").show();menuHeight=$(".dropdown-menu").height();$("#actions-options").css("top",e.pageY-menuHeight-yOffset+"px").css("left",e.pageX-xOffset+"px")}else{$(".dropdown-menu").hide()}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}});$(".dropdown-menu").bind("mouseleave",function(){$(".dropdown-menu").hide()});$(document).on("click","a.insert",function(e){var t=$(this).attr("id").split("_");id=t[1];var n=$("#ext_"+id).text();var r=$("#edit_"+id).text();if(window.name!=null&&window.name!=""){console.log("Plugin mode");fileName=decodeURI("/"+folder+r+n);$(opener.document.getElementsByName(window.name)).val(fileName);$(opener.document.getElementsByName(window.name)).focus();self.close()}else{try{console.log("PTinyMCE mode");ezDialogue.fileSubmit(http+domain+folder+r+n)}catch(i){console.log("Standalone mode")}}$(".dropdown-menu").hide();if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}});$(document).on("click","a.insert-plugin",function(e){var t=$(this).attr("id").split("_");id=t[1];var n=$("#ext_"+id).text();var r=$("#edit_"+id).text();try{fileName=decodeURI("/"+folder+r+n);$(opener.document.getElementsByName(window.name)).val(fileName);$(opener.document.getElementsByName(window.name)).focus();self.close()}catch(i){console.log("Plugin mode")}$(".dropdown-menu").hide();if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}});var ezDialogue={init:function(){var e=document.getElementsByTagName("link");e[e.length-1].parentNode.removeChild(e[e.length-1])},fileSubmit:function(e){var t=e;var n=top.tinymce.activeEditor.windowManager.getParams().window;n.document.getElementById(top.tinymce.activeEditor.windowManager.getParams().input).value=t;top.tinymce.activeEditor.windowManager.close()}};$("a.download").click(function(e){id=$(this).attr("id");var t=$("#ext_"+id).text();var n=$("#edit_"+id).text();$(".dropdown-menu").hide();hideNotifications();$(".successmsg").html("<h4>"+fileDownload+" "+n+t+"</h4>");jQuery(".successmsg").show();$(".successmsg").animate({top:"0"},500);setTimeout(function(){hideNotifications()},3e3);window.location.href=location.protocol+"//"+location.host+location.pathname+"?folder="+folder+"&action=download&file="+n+t;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}});$("a.copy").click(function(e){id=$(this).attr("id");var t=$("#ext_"+id).text();var n=$("#edit_"+id).text();$(".dropdown-menu").hide();hideNotifications();$(".successmsg").html("<h4>"+n+t+" "+fileCopy+"</h4>");jQuery(".successmsg").show();$(".successmsg").animate({top:"0"},500);setTimeout(function(){hideNotifications()},3e3);$.ajax({type:"POST",url:indexFile+"?folder="+folder+"&action=copy",data:{file:n,extension:t},success:function(e){if(e!=""){$("#response").html("<span class='alert alert-danger response'>"+e+"</span>");setInterval(function(){$("#response").html("")},3e3)}}});if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}});$(".editable").click(function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}});$(document).on("click","a.rename",function(e){id=$(this).attr("id");$("#href_"+id).click(function(){return false});var t=$("#ext_"+id).text();var n=$("#edit_"+id).text();$.post(indexFile+"?folder="+folder+"&action=oldfilename",{oldfilename:n,extension:t});$("#filetype-"+id).hide();$("#edit_"+id).trigger("rename");$(".dropdown-menu").hide();if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}});$.editable.addInputType("no-space",{element:$.editable.types.text.element,plugin:function(e,t){$("input",this).bind("keypress",function(e){var t=$(this).val();var n=new RegExp("^[a-zA-Z0-9-_ ]*$");t=String.fromCharCode(!e.charCode?e.which:e.charCode);if(n.test(t)){return true}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}return false});$("input",this).blur(function(){$("#href_"+id).unbind("click");var e=$.trim($(this).val());if(removeSpace==1){e=e.replace(/\s{2,}/g," ");e=e.replace(/\s/g,"-")}$("#href_"+id).attr("href",indexFile+"?folder="+folder+e);$(this).val(e)})}});$(".edit_area").editable(indexFile+"?folder="+folder+"&action=rename",{type:"no-space",submitdata:{_method:"POST"},select:true,submit:"OK",cancel:"cancel",cssclass:"editable",onreset:jeditableReset,event:"rename",callback:function(e,t){$("#href_"+id).unbind("click");$("#filetype-"+id).show()}});$(document).on("click","a.filedelete",function(e){id=$(this).attr("id");file_extension=$("#ext_"+id).text();var t=$("#edit_"+id).text();var n=confirm(confirmFile+" "+t+file_extension+"?");if(n==true){$.ajax({type:"POST",url:indexFile+"?folder="+folder+"&action=delete",data:{file:t,extension:file_extension},success:function(e){if(e!=""){$("#response").html("<span class='alert alert-danger response'>"+removeError+' "'+e+'"</span>');setInterval(function(){$("#response").html("")},3e3)}else{$(this).closest("tr").remove();$("#tr_"+id).remove()}}});if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}else{if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}});$(document).on("click","a.ajaxdelete",function(e){id=$(this).attr("id");file_extension=$("#ext_"+id).text();var t=$("#edit_"+id).text();var n=confirm(confirmFile+" "+t+file_extension+"?");if(n==true){$.ajax({type:"POST",url:indexFile+"?folder="+folder+"&action=delete",data:{file:t,extension:file_extension},success:function(e){if(e!=""){$("#response").html("<span class='alert alert-danger response'>"+removeError+' "'+e+'"</span>');setInterval(function(){$("#response").html("")},3e3)}else{$("#tr_"+id).remove()}}});if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}else{if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}});$("#foldercreate",this).bind("keypress",function(e){var t=$(this).val();var n=new RegExp("^[a-zA-Z0-9-_s\r\n ]*$");t=String.fromCharCode(!e.charCode?e.which:e.charCode);if(n.test(t)){return true}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}return false});$("#foldercreateForm").submit(function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}var t=$("textarea[name=foldercreate]").val().split("\n");if(typeof y==="undefined"){y=1}$.each(t,function(){var t=$.trim(this);if(removeSpace==1){t=t.replace(/\s{2,}/g," ");t=t.replace(/\s/g,"-")}if(t!=""){$.ajax({type:"POST",url:indexFile+"?folder="+folder+"&action=createfolder",data:{directory:t},success:function(e){if(e=="error"){$("#response").append("<span class='alert alert-danger response'>"+createError+": "+t+"</span>")}else if(e=="empty"){$("#response").append("<span class='alert alert-danger response'>"+emptycreateError+"</span>")}else{y++;$('<tr class="success" id="tr_a'+y+'"><td style="width:10px"><input type="checkbox" id="record_a'+y+'" value="'+e+'" class="del" name="_del[a'+y+']" alt="a'+y+'"></td><td style="width:10px"></td><td style="width:10px"><a id="a'+y+'" class="ajaxdelete"  alt="folder" href="#"><span class="glyphicon glyphicon-trash"></span></a></td><td colspan="3"><a href="'+indexFile+"?folder="+folder+e+'/" id="href_a'+y+'"><span class="glyphicon glyphicon-folder-open"></span>&nbsp;&nbsp;<span id="edit_a'+y+'" alt="a'+y+'">'+e+'</span><span id="ext_a'+y+'"></span></a></td></tr>').prependTo("table > tbody");$("#emptyTable").remove()}}});setInterval(function(){$("#response").html("")},3e3);$("textarea[name=foldercreate]").val("");$("#ezfm-tab a:first").tab("show");$(".pane-home").slimScroll({scrollTo:"0px"});if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}}})});$("#type-control").change(function(){window.location.href=location.protocol+"//"+location.host+location.pathname+"?folder="+folder+"&type="+this.value});$("#uploadForm").submit(function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}var t=$(".filetoupload").val();var n=$("#filetoupload")[0].files;if(n.length>maxFileUpload){hideNotifications();$(".errormsg").html("<h4>"+n.length+" "+selectedFiles+": "+maxFileUpload+" "+toomanyError+"</h4>");jQuery(".errormsg").show();$(".errormsg").animate({top:"0"},500);setTimeout(function(){hideNotifications()},3e3);return false}for(var r=0;r<n.length;r++){var i=n[r].type.split("/");console.log(n[r].name,n[r].type,n[r].size,i[1]);if(!valid_extensions.test(n[r].name)){hideNotifications();$(".errormsg").html("<h4>"+n[r].name+" "+invalidError+"</h4>");jQuery(".errormsg").show();$(".errormsg").animate({top:"0"},500);setTimeout(function(){hideNotifications()},3e3);return false}if(n[r].size>maxFileSize){hideNotifications();$(".errormsg").html("<h4>"+n[r].name+" "+tooLargeError+"</h4>");jQuery(".errormsg").show();$(".errormsg").animate({top:"0"},500);setTimeout(function(){hideNotifications()},3e3);return false}}if(t){var s=1;var o=new FormData($("#uploadForm")[0]);$.ajax({url:indexFile+"?folder="+folder+"&action=upload",type:"POST",xhr:function(){var e=$.ajaxSettings.xhr();if(e.upload){e.upload.addEventListener("progress",progress,false)}return e},data:o,cache:false,contentType:false,processData:false,success:function(e){$(e).prependTo("table > tbody");$("#progress").hide();$("#upload_files").html("");$("#upload_files").hide();$("#emptyTable").remove();$("#ezfm-tab a:first").tab("show");$("html, body").animate({scrollTop:0},"slow");$("html, body").animate({scrollTop:0},"slow");$(".pane-home").slimScroll({scrollTo:"0px"})}});$("#uploadForm")[0].reset()}return true});$(".btn-file :file").on("fileselect",function(e,t,n){var r=$(this).parents(".input-group").find(":text"),i=t>1?t+" "+selectedFiles:n;r.val(i)});$(document).on("change",".btn-file :file",function(){$("#upload_files").html("");var e=$("#filetoupload")[0].files;if(e.length>1){for(var t=0;t<e.length;t++){$("#upload_files").append('"'+e[t].name+'" ')}$("#upload_files").show()}var n=$(this),r=n.get(0).files?n.get(0).files.length:1,i=n.val().replace(/\\/g,"/").replace(/.*\//,"");n.trigger("fileselect",[r,i])});$("#selectSelects").click(function(){var e=this.checked;$("#filelist tbody tr").find("td:first :checkbox").each(function(){$(this).prop("checked",e)})});$("#pagerefresh").click(function(){document.location.reload()});$("#logout").click(function(){document.location.href="?logout=1"});$(function(){$(".multiaction").click(function(){id=$(this).attr("id");if(id=="pasteFiles"){doPaste();return true}else{if(CheckifCheckBoxChecked()){var delMsg=confirm(eval($(this).attr("id")));if(delMsg==true){id=$(this).attr("id");if(id=="deleteFiles"){doMultiDelete()}else{return false}return false}return false}else{hideNotifications();$(".errormsg").html("<h4>"+nothingError+"</h4>");jQuery(".errormsg").show();$(".errormsg").animate({top:"0"},500);setTimeout(function(){hideNotifications()},3e3);return false}}})});$.fn.redraw=function(){$(this).each(function(){var e=this.offsetHeight;console.log("Repainting")})};$(".container").redraw()});if(!DEBUG_MODE){console=console||{};console.log=function(){}}